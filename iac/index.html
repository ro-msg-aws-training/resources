<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Infrastructure as Code (IaC) | Getting Productive with AWS</title>
    <meta name="generator" content="VuePress 1.5.1">
    
    <meta name="description" content="The quickest way to be productive with Amazon Web Services. It covers the most used (by far) services and common architectures/patterns.">
    <link rel="preload" href="/resources/assets/css/0.styles.75c63107.css" as="style"><link rel="preload" href="/resources/assets/js/app.fa55c005.js" as="script"><link rel="preload" href="/resources/assets/js/2.cb8e4adb.js" as="script"><link rel="preload" href="/resources/assets/js/7.e9a200d8.js" as="script"><link rel="prefetch" href="/resources/assets/js/10.3f132d46.js"><link rel="prefetch" href="/resources/assets/js/11.444d3a84.js"><link rel="prefetch" href="/resources/assets/js/12.c58705c0.js"><link rel="prefetch" href="/resources/assets/js/13.75977d54.js"><link rel="prefetch" href="/resources/assets/js/3.4cba817d.js"><link rel="prefetch" href="/resources/assets/js/4.1a9da7e5.js"><link rel="prefetch" href="/resources/assets/js/5.aca55b77.js"><link rel="prefetch" href="/resources/assets/js/6.eac666c5.js"><link rel="prefetch" href="/resources/assets/js/8.dd431537.js"><link rel="prefetch" href="/resources/assets/js/9.458b4a91.js">
    <link rel="stylesheet" href="/resources/assets/css/0.styles.75c63107.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/resources/" class="home-link router-link-active"><!----> <span class="site-name">Getting Productive with AWS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/resources/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/ro-msg-aws-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AWS Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ro-msg-react-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  React Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ro-msg-spring-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/resources/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/ro-msg-aws-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AWS Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ro-msg-react-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  React Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ro-msg-spring-training/resources" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Training
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/resources/" aria-current="page" class="sidebar-link">Contents</a></li><li><a href="/resources/cloud/" class="sidebar-link">Cloud Intro</a></li><li><a href="/resources/aws/" class="sidebar-link">AWS Intro</a></li><li><a href="/resources/services/" class="sidebar-link">AWS Services</a></li><li><a href="/resources/iac/" aria-current="page" class="active sidebar-link">Infrastructure as Code</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/resources/iac/#resources" class="sidebar-link">Resources</a></li><li class="sidebar-sub-header"><a href="/resources/iac/#parameters" class="sidebar-link">Parameters</a></li><li class="sidebar-sub-header"><a href="/resources/iac/#mappings-conditions" class="sidebar-link">Mappings &amp; Conditions</a></li><li class="sidebar-sub-header"><a href="/resources/iac/#outputs" class="sidebar-link">Outputs</a></li></ul></li><li><a href="/resources/infra/" class="sidebar-link">Regions and AZs</a></li><li><a href="/resources/iam/" class="sidebar-link">IAM</a></li><li><a href="/resources/security/" class="sidebar-link">Security</a></li><li><a href="/resources/networking/" class="sidebar-link">Networking</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="infrastructure-as-code-iac"><a href="#infrastructure-as-code-iac" class="header-anchor">#</a> Infrastructure as Code (IaC)</h1> <p>When you interact with the cloud providers for the first time, you will most likely use the web interface to provision and setup the infrastructure (e.g. launch a VM). This is a good option at the beginning since it helps you to get used to the available services and what options they offer (e.g. you see a nice list with the available AMIs and instance types when launching an EC2 instance).</p> <p>While it might be fun for the first few times, it will become just some other repetitive and time-consuming task (and overhead) as the time goes by. Additionally, manual work always imposes the risk of human error (we might forget to tick some checkbox or miss-click some instance type). Large projects can quickly add up to tens of thousands of infrastructure resources that have to be configured and provisioned.</p> <p>These issues can be addressed by being able to declare/write the infrastructure in some text files and have cloud platforms interpret the files and automatically setup the required infrastructure for us or, in other words, infrastructure as code.</p> <p>Other (huge) benefits of having the infrastructure declared in text files include the capability to <strong>version control</strong> your infrastructure and to <strong>review changes</strong> (just like any other piece of code).</p> <p>In AWS, the service responsible for managing resources based on the code you provide (<strong>template</strong>) is called <strong>CloudFormation</strong>.</p> <p>One important characteristic of CloudFormation is that it works with <strong>stacks</strong>. These basically group all resources created by CloudFormation for a given template. This makes cleaning-up infrastructure a breeze since it is reduced down to deleting the stack (i.e. when you delete a stack, all the created EC2 instances, security groups, load balancers and so on are deleted automatically) (there are some resources that cannot/will not be deleted automatically, but we will not worry about those for now).</p> <p>We will use CloudFormation in the following chapters. For now it is enough if you understand its basic structure. First of all, templates are written in JSON or YAML. We (and the rest of the world) will use yaml since it is considerably easier to read and understand.</p> <p>If you are not familiar with yaml, take a few minutes to get a grasp of it. <a href="https://dev.to/paulasantamaria/introduction-to-yaml-125f" target="_blank" rel="noopener noreferrer">This post<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> should be more than enough for now.</p> <p>Templates can contain 5 main types of definitions: resources, parameters, mappings, conditions and outputs.</p> <h2 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h2> <p>This is the only mandatory type for a CloudFormation template. As the name says, <strong>resources</strong> describe the infrastructure resources that will be provisioned, such as VMs (EC2 instances), networks (VPCs), security groups, databases and many more (the complete list can be found <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <p>A very basic example of defining an ec2 instance is:</p> <div class="language- extra-class"><pre class="language-text"><code>Resources:
  ExampleEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0ff8a91507f77f867
      InstanceType: t2.micro
</code></pre></div><h2 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h2> <p>Most projects have different environments (dev, staging, prod etc.). While the services used to compose these environments might be the same (they should be), the amount of resources is not necessarily the same. One of the most important factors when building systems is the cost optimization (this is also one of the 5 pillars of the <a href="https://wa.aws.amazon.com/wat.pillars.wa-pillars.en.html" target="_blank" rel="noopener noreferrer">Well-Architected Framework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> proposed by AWS). In case of a production environment we need a certain amount of resources (to handle our users) while for the development environment, most of the times, we will need much less resources, for example smaller ec2 instances.</p> <p>We could, of course, have separate templates for each environment or we could leverage <strong>parameters</strong> to customize the resulting stack based on the same template.</p> <p>For example, we can define a parameter to customize the ec2 instance as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>Parameters: 
  InstanceTypeParameter: 
    Type: String
    Default: t2.micro
    AllowedValues: 
      - t2.micro
      - m1.small
      - m1.large
    Description: Enter t2.micro, m1.small, or m1.large. Default is t2.micro.
</code></pre></div><p>This parameter can then be used in the <strong>resources</strong> section:</p> <div class="language- extra-class"><pre class="language-text"><code>Resources:
  ExampleEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0ff8a91507f77f867
      InstanceType: !Ref InstanceTypeParameter
</code></pre></div><h2 id="mappings-conditions"><a href="#mappings-conditions" class="header-anchor">#</a> Mappings &amp; Conditions</h2> <p>If parameters are intended for customizing based on outside/user (developer) input, mappings and conditions are used to customize the resulting stack based on other factors, for example the region where the stack is being launched. They can also be used together with parameters since it is possible to define the allowed values for each parameters (e.g. the AllowedValues from above). A nice example of using mappings and conditions can be found <a href="https://www.singlestoneconsulting.com/blog/cloudformation-mapping-and-conditionals-making-your-templates-more-universal/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="outputs"><a href="#outputs" class="header-anchor">#</a> Outputs</h2> <p>The primary usage of the outputs is to act as the input of another template. Of course we can also display them once our template is executed.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/resources/services/" class="prev">
        AWS Services
      </a></span> <span class="next"><a href="/resources/infra/">
        Regions and AZs
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/resources/assets/js/app.fa55c005.js" defer></script><script src="/resources/assets/js/2.cb8e4adb.js" defer></script><script src="/resources/assets/js/7.e9a200d8.js" defer></script>
  </body>
</html>
